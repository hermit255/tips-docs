(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{845:function(e,t,n){Promise.resolve().then(n.bind(n,9222))},9222:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var l=n(7437),s=n(2265);function WikiLayout(e){let{children:t}=e;return(0,l.jsx)("div",{className:"wiki-container",children:t})}let o=[{id:"self-reference",name:"自ファイル名参照",description:"自mdファイル名に該当する場合は特殊リンクを設定しない",enabled:!0,type:"self-reference"},{id:"kanji-context",name:"漢字コンテキスト",description:"該当するワードの前後どちらかに漢字がある場合は特殊リンクを設定しない",enabled:!0,type:"kanji-context"}];function shouldSkipLink(e,t,n,l,s){let o=s.filter(e=>e.enabled);for(let s of o)switch(s.type){case"self-reference":if(e===l)return!0;break;case"kanji-context":if(hasKanjiContext(t,n,e.length))return!0;break;case"custom":var c;if(null===(c=s.config)||void 0===c?void 0:c.pattern)try{let t=new RegExp(s.config.pattern,s.config.flags||"g");if(t.test(e))return!0}catch(e){console.warn("Invalid custom rule pattern: ".concat(s.config.pattern),e)}}return!1}function hasKanjiContext(e,t,n){let l=e[t-1],s=e[t+n],o="string"==typeof l&&isKanji(l),c="string"==typeof s&&isKanji(s);return o||c}function isKanji(e){let t=e.charCodeAt(0);return t>=19968&&t<=40959||t>=13312&&t<=19903||t>=131072&&t<=173791||t>=173824&&t<=177983||t>=177984&&t<=178207||t>=178208&&t<=183983||t>=183984&&t<=191471||t>=196608&&t<=201551}function buildMenuStructure(e){let t=new Map,n=[];for(let l of e){let e=l.path.split("/"),s="",o=n;for(let n=0;n<e.length;n++){let l=e[n];if(s=s?"".concat(s,"/").concat(l):l,!t.has(s)){let c=n===e.length-1,r={name:l.replace(/\.md$/,""),path:s,type:c?"file":"folder",children:c?void 0:[]};t.set(s,r),o.push(r)}let c=t.get(s);c.children&&(o=c.children)}}return n}function extractTocFromHtml(e){let t;let n=[];console.log("Extracting TOC from HTML:",e.substring(0,500)+"...");let l=/<h([1-6])[^>]*id="([^"]*)"[^>]*>(.*?)<\/h[1-6]>/gi;for(;null!==(t=l.exec(e));){let e=parseInt(t[1]),l=t[2],s=t[3].replace(/<[^>]*>/g,"");n.push({id:l,text:s,level:e})}if(0===n.length){let l=/<h([1-6])[^>]*>(.*?)<\/h[1-6]>/gi;for(;null!==(t=l.exec(e));){let e=parseInt(t[1]),l=t[2].replace(/<[^>]*>/g,""),s=l.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-]/g,"");n.push({id:s,text:l,level:e})}}return console.log("Generated TOC:",n),n}function processContentWithLinks(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o,c=e;return t.forEach(e=>{let t=e.title,n=RegExp("(?<!##)".concat(t,"(?!##)"),"g");c=c.replace(n,(t,n)=>shouldSkipLink(t,c,n,l,s)?t:'<span class="term-link" data-term="'.concat(e.slug,'">').concat(t,"</span>"))}),n.forEach(e=>{let t=e.title,n=RegExp("(?<!##)".concat(t,"(?!##)"),"g");c=c.replace(n,(t,n)=>shouldSkipLink(t,c,n,l,s)?t:'<span class="doc-link" data-doc="'.concat(e.path,'">').concat(t,"</span>"))}),c}function MenuPane(e){let{docs:t,terms:n,onDocSelect:o,onTermSelect:c,selectedDoc:r,selectedTerm:i,selectedProject:a,projects:d,onProjectSelect:u}=e,[h,p]=(0,s.useState)("docs"),m=buildMenuStructure(t),renderMenuItem=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=r===e.path;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"menu-item ".concat(n?"selected":""),style:{paddingLeft:"".concat(20*t,"px")},onClick:()=>{"file"===e.type&&(console.log("MenuPane: Clicking doc with path:",e.path),console.log("MenuPane: Item details:",{name:e.name,path:e.path,type:e.type}),o(e.path))},children:"folder"===e.type?(0,l.jsxs)("span",{className:"menu-folder",children:["\uD83D\uDCC1 ",e.name]}):(0,l.jsxs)("span",{className:"menu-file",children:["\uD83D\uDCC4 ",e.name]})}),e.children&&e.children.map(e=>renderMenuItem(e,t+1))]},e.path)};return(0,l.jsxs)("div",{className:"menu-pane",children:[(0,l.jsx)("div",{style:{padding:"10px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #ddd"},children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[(0,l.jsx)("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"プロジェクト:"}),(0,l.jsx)("select",{value:a,onChange:e=>u(e.target.value),style:{padding:"4px 8px",fontSize:"12px",border:"1px solid #ccc",borderRadius:"4px"},children:d.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.name))})]})}),(0,l.jsxs)("div",{className:"tab-container",children:[(0,l.jsx)("button",{className:"tab ".concat("docs"===h?"active":""),onClick:()=>p("docs"),children:"ドキュメント"}),(0,l.jsx)("button",{className:"tab ".concat("terms"===h?"active":""),onClick:()=>p("terms"),children:"用語"})]}),(0,l.jsxs)("div",{children:["docs"===h&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"ドキュメント一覧"}),m.map(e=>renderMenuItem(e))]}),"terms"===h&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"用語一覧"}),n.length>0?(0,l.jsx)("div",{children:n.map(e=>{let t=i===e.slug;return(0,l.jsx)("div",{className:"menu-item ".concat(t?"selected":""),onClick:()=>c(e.slug),children:(0,l.jsxs)("span",{className:"menu-file",children:["\uD83D\uDCD6 ",e.title]})},e.slug)})}):(0,l.jsx)("p",{children:"用語がありません"})]})]})]})}function stripHtmlTags(e){return e?e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim():""}function TermTooltip(e){let{term:t,x:n,y:s,onClick:o}=e;return(0,l.jsxs)("div",{className:"tooltip",style:{left:"".concat(n+10,"px"),top:"".concat(s-10,"px")},onClick:o,children:[t.summary&&(0,l.jsx)("div",{style:{marginTop:"4px",fontSize:"12px"},children:stripHtmlTags(t.summary)}),t.synonyms&&t.synonyms.length>0&&(0,l.jsxs)("div",{style:{marginTop:"4px",fontSize:"11px",color:"#ddd"},children:["類義語: ",t.synonyms.slice(0,3).join(", "),t.synonyms.length>3&&"..."]}),t.antonyms&&t.antonyms.length>0&&(0,l.jsxs)("div",{style:{marginTop:"4px",fontSize:"11px",color:"#ddd"},children:["対義語: ",t.antonyms.slice(0,3).join(", "),t.antonyms.length>3&&"..."]}),(0,l.jsx)("div",{style:{marginTop:"4px",fontSize:"10px",color:"#ccc"},children:"クリックで詳細表示"})]})}function ContentPane(e){let{selectedDoc:t,selectedTerm:n,terms:o,docs:c,projectName:r,onTermSelect:i,onDocSelect:a}=e,[d,u]=(0,s.useState)(null),[h,p]=(0,s.useState)(null),[m,f]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(t&&r){console.log("ContentPane: Fetching doc with path:",t,"project:",r);let e=encodeURIComponent(t),n="/api/docs/".concat(e,"?project=").concat(encodeURIComponent(r));console.log("ContentPane: Encoded path:",e),console.log("ContentPane: Full URL:",n),f(!0),fetch(n).then(e=>{if(console.log("ContentPane: Response status:",e.status),!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json()}).then(e=>{console.log("ContentPane: Received doc data:",e),u(e),p(null)}).catch(e=>{console.error("ContentPane: Failed to fetch doc:",e),u(null)}).finally(()=>f(!1))}},[t,r]);let handleTermMouseEnter=(e,t)=>{let n=o.find(t=>t.slug===e);n&&g({term:n,x:t.clientX,y:t.clientY})},handleTermClick=e=>{i(e),g(null)};if(m)return(0,l.jsx)("div",{className:"content-pane",children:(0,l.jsx)("div",{children:"読み込み中..."})});if(d){let e=processContentWithLinks(d.html,o,c,d.title);return(0,l.jsxs)("div",{className:"content-pane",children:[(0,l.jsx)("h1",{children:d.title}),(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:e},onClick:e=>{let t=e.target;if(t.classList.contains("term-link")){let e=t.getAttribute("data-term");e&&handleTermClick(e)}else if(t.classList.contains("doc-link")){let e=t.getAttribute("data-doc");e&&a(e)}else g(null)},onMouseMove:e=>{let t=e.target;if(t.classList.contains("term-link")){let n=t.getAttribute("data-term");n&&!x&&handleTermMouseEnter(n,e)}else g(null)}}),x&&(0,l.jsx)(TermTooltip,{term:x.term,x:x.x,y:x.y,onClick:()=>handleTermClick(x.term.slug)})]})}return(0,l.jsx)("div",{className:"content-pane",children:(0,l.jsx)("div",{children:"ドキュメントまたは用語を選択してください"})})}function ResizeHandle(e){let{onMouseDown:t}=e;return(0,l.jsx)("div",{className:"resize-handle",onMouseDown:t,style:{position:"absolute",left:0,top:0,width:"4px",height:"100%",cursor:"col-resize",backgroundColor:"transparent",zIndex:10,borderLeft:"2px solid transparent",transition:"border-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.borderLeftColor="#007acc"},onMouseLeave:e=>{e.currentTarget.style.borderLeftColor="transparent"}})}function useResizable(e){let{initialWidth:t,minWidth:n,maxWidth:l,storageKey:o}=e,[c,r]=(0,s.useState)(()=>{if(o){let e=localStorage.getItem(o);if(e){let t=parseInt(e,10);if(!isNaN(t)&&t>=n&&t<=l)return t}}return t}),i=(0,s.useCallback)(e=>{o&&localStorage.setItem(o,e.toString())},[o]),a=(0,s.useCallback)(e=>{e.preventDefault();let t=e.clientX,s=c,handleMouseMove=e=>{let o=e.clientX-t,i=Math.max(n,Math.min(l,c-o));s=i,r(i),console.log("Resize: deltaX=".concat(o,", startWidth=").concat(c,", newWidth=").concat(i))},handleMouseUp=()=>{document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp),document.body.style.cursor="",document.body.style.userSelect="",i(s)};document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[c,n,l,i]);return{width:c,startResize:a}}function SubPane(e){let{tab:t,onTabChange:n,selectedDoc:o,selectedTerm:c,terms:r,docs:i,projectName:a,onTermSelect:d,onDocSelect:u}=e,[h,p]=(0,s.useState)([]),[m,f]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),{width:j,startResize:y}=useResizable({initialWidth:300,minWidth:200,maxWidth:600,storageKey:"subpane-width"});(0,s.useEffect)(()=>{o&&a?fetch("/api/docs/".concat(o,"?project=").concat(encodeURIComponent(a))).then(e=>e.json()).then(e=>{f(e);let t=extractTocFromHtml(e.html);p(t)}).catch(e=>console.error("Failed to fetch doc for TOC:",e)):(f(null),p([]))},[o,a]);let handleTocClick=e=>{let t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth"})},handleTermClick=e=>{d(e),g(null)},handleContentClick=e=>{let t=e.target;if(t.classList.contains("term-link")){let e=t.getAttribute("data-term");e&&handleTermClick(e)}else if(t.classList.contains("doc-link")){let e=t.getAttribute("data-doc");e&&u(e)}else g(null)},handleContentMouseMove=e=>{let t=e.target;if(t.classList.contains("term-link")){let n=t.getAttribute("data-term");if(n&&!x){let t=r.find(e=>e.slug===n);t&&g({term:t,x:e.clientX,y:e.clientY})}}else g(null)};return(0,l.jsxs)("div",{className:"sub-pane",style:{width:"".concat(j,"px")},children:[(0,l.jsx)(ResizeHandle,{onMouseDown:y}),(0,l.jsxs)("div",{style:{paddingLeft:"4px"},children:[(0,l.jsxs)("div",{className:"tab-container",children:[(0,l.jsx)("button",{className:"tab ".concat("toc"===t?"active":""),onClick:()=>n("toc"),children:"TOC"}),(0,l.jsx)("button",{className:"tab ".concat("preview"===t?"active":""),onClick:()=>n("preview"),children:"用語"})]}),(0,l.jsxs)("div",{children:["toc"===t&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"目次"}),h.length>0?(0,l.jsx)("div",{className:"toc-container",children:h.map(e=>{let t="toc-item toc-h".concat(e.level);return(0,l.jsx)("div",{className:t,onClick:()=>handleTocClick(e.id),children:e.text},e.id)})}):(0,l.jsx)("p",{children:"目次がありません"})]}),"preview"===t&&(0,l.jsx)("div",{children:c?(0,l.jsx)("div",{children:(()=>{let e=r.find(e=>e.slug===c);return e?(0,l.jsxs)("div",{className:"term-page",onClick:handleContentClick,onMouseMove:handleContentMouseMove,children:[(0,l.jsx)("h1",{children:e.title}),e.summary&&(0,l.jsxs)("section",{children:[(0,l.jsx)("h3",{children:"概要"}),(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:processContentWithLinks(e.summary,r,i,e.title)}})]}),e.description&&(0,l.jsxs)("section",{children:[(0,l.jsx)("h3",{children:"詳細"}),(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:processContentWithLinks(e.description,r,i,e.title)}})]}),e.synonyms&&e.synonyms.length>0&&(0,l.jsxs)("section",{children:[(0,l.jsx)("h3",{children:"類義語"}),(0,l.jsx)("ul",{children:e.synonyms.map((t,n)=>(0,l.jsx)("li",{dangerouslySetInnerHTML:{__html:processContentWithLinks(t,r,i,e.title)}},n))})]}),e.antonyms&&e.antonyms.length>0&&(0,l.jsxs)("section",{children:[(0,l.jsx)("h3",{children:"対義語"}),(0,l.jsx)("ul",{children:e.antonyms.map((t,n)=>(0,l.jsx)("li",{dangerouslySetInnerHTML:{__html:processContentWithLinks(t,r,i,e.title)}},n))})]}),e.siblings&&e.siblings.length>0||e.parents&&e.parents.length>0||e.children&&e.children.length>0?(0,l.jsxs)("section",{children:[e.siblings&&e.siblings.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"兄弟"}),1===e.siblings.length?(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:processContentWithLinks(e.siblings[0],r,i,e.title)}}):(0,l.jsx)("ul",{children:e.siblings.map((t,n)=>(0,l.jsx)("li",{dangerouslySetInnerHTML:{__html:processContentWithLinks(t,r,i,e.title)}},n))})]}),e.parents&&e.parents.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"親"}),1===e.parents.length?(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:processContentWithLinks(e.parents[0],r,i,e.title)}}):(0,l.jsx)("ul",{children:e.parents.map((t,n)=>(0,l.jsx)("li",{dangerouslySetInnerHTML:{__html:processContentWithLinks(t,r,i,e.title)}},n))})]}),e.children&&e.children.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"子"}),1===e.children.length?(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:processContentWithLinks(e.children[0],r,i,e.title)}}):(0,l.jsx)("ul",{children:e.children.map((t,n)=>(0,l.jsx)("li",{dangerouslySetInnerHTML:{__html:processContentWithLinks(t,r,i,e.title)}},n))})]})]}):null]}):(0,l.jsx)("p",{children:"用語が見つかりません"})})()}):(0,l.jsx)("p",{children:"用語を選択すると用語ページが表示されます"})})]})]}),x&&(0,l.jsx)(TermTooltip,{term:x.term,x:x.x,y:x.y,onClick:()=>handleTermClick(x.term.slug)})]})}function useFileWatcher(e){(0,s.useEffect)(()=>{let t=new EventSource("/api/watch");return t.onmessage=t=>{"file-changed"===t.data&&e()},t.onerror=e=>{console.error("EventSource failed:",e)},()=>{t.close()}},[e])}function useMarkdownData(e){let[t,n]=(0,s.useState)([]),[l,o]=(0,s.useState)([]),[c,r]=(0,s.useState)(!0),i=(0,s.useCallback)(async()=>{if(e)try{r(!0);let[t,l]=await Promise.all([fetch("/api/docs?project=".concat(encodeURIComponent(e))),fetch("/api/terms?project=".concat(encodeURIComponent(e)))]),s=await t.json(),c=await l.json();n(s),o(c)}catch(e){console.error("Failed to fetch markdown data:",e)}finally{r(!1)}},[e]);return(0,s.useEffect)(()=>{i()},[i]),useFileWatcher(i),{docs:t,terms:l,loading:c}}function useProjects(){let[e,t]=(0,s.useState)([]),[n,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async function(){try{let e=await fetch("/api/projects"),n=await e.json();t(n)}catch(e){console.error("Failed to fetch projects:",e)}finally{l(!1)}})()},[]),{projects:e,loading:n}}function Home(){let[e,t]=(0,s.useState)(""),[n,o]=(0,s.useState)(null),[c,r]=(0,s.useState)(null),[i,a]=(0,s.useState)("toc"),[d,u]=(0,s.useState)(!1),{projects:h,loading:p}=useProjects(),{docs:m,terms:f,loading:x}=useMarkdownData(e);(0,s.useEffect)(()=>{u(!0);let e=localStorage.getItem("last-selected-project");e&&t(e)},[]),(0,s.useEffect)(()=>{if(d&&!p&&h.length>0&&e){let n=h.some(t=>t.name===e);n||(console.log("Saved project not found, clearing selection:",e),t(""),localStorage.removeItem("last-selected-project"))}},[d,h,p,e]);let handleDocSelect=e=>{console.log("Page: handleDocSelect called with path:",e),o(e),r(null),a("toc")},handleTermSelect=e=>{r(e),a("preview")},handleProjectSelect=e=>{t(e),o(null),r(null),a("toc"),d&&localStorage.setItem("last-selected-project",e)};return e?(0,l.jsxs)(WikiLayout,{children:[(0,l.jsx)(MenuPane,{docs:m,terms:f,onDocSelect:handleDocSelect,onTermSelect:e=>{r(e),o(null),a("preview")},selectedDoc:n,selectedTerm:c,selectedProject:e,projects:h,onProjectSelect:handleProjectSelect}),(0,l.jsx)(ContentPane,{selectedDoc:n,selectedTerm:c,terms:f,docs:m,projectName:e,onTermSelect:handleTermSelect,onDocSelect:handleDocSelect}),(0,l.jsx)(SubPane,{tab:i,onTabChange:a,selectedDoc:n,selectedTerm:c,terms:f,docs:m,projectName:e,onTermSelect:handleTermSelect,onDocSelect:handleDocSelect})]}):(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"20px"},children:[(0,l.jsx)("h1",{children:"プロジェクトを選択してください"}),p?(0,l.jsx)("div",{children:"読み込み中..."}):(0,l.jsxs)("select",{value:e,onChange:e=>handleProjectSelect(e.target.value),style:{padding:"10px",fontSize:"16px",minWidth:"200px"},children:[(0,l.jsx)("option",{value:"",children:"プロジェクトを選択"}),h.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.name))]})]})}},622:function(e,t,n){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l=n(2265),s=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,n){var l,i={},a=null,d=null;for(l in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,l)&&!r.hasOwnProperty(l)&&(i[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps)void 0===i[l]&&(i[l]=t[l]);return{$$typeof:s,type:e,key:a,ref:d,props:i,_owner:c.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,n){"use strict";e.exports=n(622)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=845)}),_N_E=e.O()}]);