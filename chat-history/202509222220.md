# チャットログ - 2025年09月22日 22:20

## ユーザーリクエスト
プロジェクトを選択可能にしましょう。最初にプロジェクトを選択するセレクトボックスを設置して、それ以下のドキュメントや要望では選択したプロジェクト配下のドキュメントだけが選択できるようになります。

## 実装内容

### 1. プロジェクト管理機能の追加
- **プロジェクト一覧取得API**: `/api/projects` エンドポイントを追加
- **プロジェクト検出ロジック**: `projects/` 配下のディレクトリを自動検出
- **プロジェクト検証**: `docs` または `terms` フォルダが存在するディレクトリのみをプロジェクトとして認識

### 2. プロジェクト選択UI
- **初期画面**: プロジェクトが選択されていない場合の専用画面
- **プロジェクトセレクトボックス**: 利用可能なプロジェクト一覧から選択
- **ヘッダー表示**: 選択中のプロジェクト名を表示
- **プロジェクト切り替え**: ヘッダーのセレクトボックスでプロジェクト変更可能

### 3. データ取得のプロジェクト対応
- **API更新**: 全APIエンドポイントにプロジェクト名パラメータを追加
- **markdown処理**: 選択されたプロジェクト配下のファイルのみを処理
- **フック更新**: `useMarkdownData` にプロジェクト名パラメータを追加

### 4. 状態管理の更新
- **プロジェクト状態**: `selectedProject` 状態を追加
- **プロジェクト変更時の処理**: プロジェクト変更時に選択状態をクリア
- **プロジェクト依存データ**: プロジェクト選択に基づいてデータを取得

## 修正ファイル

### 新規作成
1. `lib/projects.ts`: プロジェクト検出と管理ロジック
2. `app/api/projects/route.ts`: プロジェクト一覧取得API
3. `hooks/useProjects.ts`: プロジェクトデータ取得フック

### 更新
1. `lib/markdown-server.ts`: プロジェクト名パラメータ対応
2. `app/api/docs/route.ts`: プロジェクト名クエリパラメータ対応
3. `app/api/terms/route.ts`: プロジェクト名クエリパラメータ対応
4. `app/api/docs/[slug]/route.ts`: プロジェクト名クエリパラメータ対応
5. `app/api/terms/[slug]/route.ts`: プロジェクト名クエリパラメータ対応
6. `hooks/useMarkdownData.ts`: プロジェクト名パラメータ対応
7. `app/page.tsx`: プロジェクト選択UIと状態管理
8. `components/ContentPane.tsx`: プロジェクト名パラメータ対応
9. `components/SubPane.tsx`: プロジェクト名パラメータ対応

## 新しい動作フロー

### 初期起動時
1. プロジェクト一覧を取得
2. プロジェクト選択画面を表示
3. ユーザーがプロジェクトを選択

### プロジェクト選択後
1. 選択されたプロジェクト配下のドキュメントと用語を取得
2. メイン画面を表示（プロジェクト名をヘッダーに表示）
3. プロジェクト配下のファイルのみが操作対象

### プロジェクト切り替え時
1. 現在の選択状態（ドキュメント、用語）をクリア
2. 新しいプロジェクト配下のデータを取得
3. メニューとコンテンツを更新

## プロジェクト検出ロジック
- `projects/` 配下のディレクトリをスキャン
- `docs` または `terms` フォルダが存在するディレクトリをプロジェクトとして認識
- プロジェクト名はディレクトリ名を使用

## 現在の対応状況
✅ プロジェクト選択機能が完全に実装されました
✅ プロジェクト配下のファイルのみが操作対象になります
✅ プロジェクト切り替え時の状態管理が適切に動作します
✅ 既存の特殊リンク機能はプロジェクト内でのみ動作します

## 技術的詳細
- **プロジェクト検出**: ファイルシステムベースの自動検出
- **API設計**: クエリパラメータによるプロジェクト指定
- **状態管理**: React state によるプロジェクト選択状態管理
- **UI/UX**: 直感的なプロジェクト選択と切り替えインターフェース
