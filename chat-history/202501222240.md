# サブペイン内でのtooltip発生位置をコンテンツペインに準じる修正

## 問題
サブペイン内でのtooltip発生位置を、コンテンツペインに準じてほしい

## 実装内容

### 1. TermTooltipコンポーネントの修正
`components/TermTooltip.tsx`でtooltipの位置計算ロジックを改善しました。

#### インターフェースの拡張
```typescript
interface TermTooltipProps {
  term: TermFile
  linkElement: HTMLElement
  onClick: () => void
  containerElement?: HTMLElement  // 新しく追加
}
```

#### 位置計算ロジックの改善
```typescript
const getTooltipPosition = () => {
  const linkRect = linkElement.getBoundingClientRect()
  
  // コンテナ要素が指定されている場合は、その要素を基準に位置を計算
  if (containerElement) {
    const containerRect = containerElement.getBoundingClientRect()
    const containerScrollTop = containerElement.scrollTop || 0
    const containerScrollLeft = containerElement.scrollLeft || 0
    
    return {
      left: (linkRect.right - containerRect.left) + containerScrollLeft + 5, // コンテナ内での相対位置
      top: (linkRect.top - containerRect.top) + containerScrollTop // コンテナ内での相対位置
    }
  } else {
    // コンテナが指定されていない場合は、従来通り画面全体を基準に計算
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop
    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft
    
    return {
      left: linkRect.right + scrollLeft + 5, // リンクテキストの終了位置よりやや右
      top: linkRect.top + scrollTop // リンクテキストのトップ位置
    }
  }
}
```

### 2. SubPaneコンポーネントの修正
`components/SubPane.tsx`でtooltip表示時にコンテナ要素を指定：

```typescript
{tooltip && (
  <TermTooltip
    term={tooltip.term}
    linkElement={tooltip.linkElement}
    onClick={() => handleTermClick(tooltip.term.slug)}
    containerElement={document.querySelector('.sub-pane') as HTMLElement}
  />
)}
```

### 3. ContentPaneコンポーネントの修正
`components/ContentPane.tsx`でtooltip表示時にコンテナ要素を指定：

```typescript
{tooltip && (
  <TermTooltip
    term={tooltip.term}
    linkElement={tooltip.linkElement}
    onClick={() => handleTermClick(tooltip.term.slug)}
    containerElement={document.querySelector('.content-pane') as HTMLElement}
  />
)}
```

## 技術的な改善点

### 位置計算の改善
- **コンテナ相対位置**: コンテナ要素が指定された場合、その要素内での相対位置を計算
- **スクロール対応**: コンテナのスクロール位置も考慮した位置計算
- **後方互換性**: コンテナが指定されない場合は従来通りの動作を維持

### 一貫性の確保
- **ContentPane**: `.content-pane`要素をコンテナとして指定
- **SubPane**: `.sub-pane`要素をコンテナとして指定
- **統一された動作**: 両方のペインで同じtooltip位置計算ロジックを使用

## 結果
✅ サブペイン内でのtooltip位置がコンテンツペインと同様の計算方法で表示されます
✅ コンテナ要素内での相対位置でtooltipが表示されます
✅ スクロール位置も考慮した正確な位置計算が行われます
✅ 後方互換性を維持し、既存の動作に影響しません

## 修正ファイル
1. `components/TermTooltip.tsx`: 位置計算ロジックの改善とコンテナ要素対応
2. `components/SubPane.tsx`: tooltip表示時にコンテナ要素を指定
3. `components/ContentPane.tsx`: tooltip表示時にコンテナ要素を指定
