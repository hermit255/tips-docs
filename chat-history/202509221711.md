# チャットログ - 2025年09月22日 17:11

## ユーザーリクエスト
副作用が起きているようです。サブペインの挙動は正確なのですが、用語リンクのクリック時、コンテンツペインの状態が変化してしまっています。

## 問題の分析
**発生していた副作用**:
- 用語リンクをクリック → ドキュメント選択がクリアされる → コンテンツペインが空になる
- サブペインには用語ページが正しく表示されるが、コンテンツペインの状態が変化してしまう

**原因**:
- `handleTermSelect`関数で`setSelectedDoc(null)`を実行していたため
- 用語選択時にドキュメント選択をクリアしてしまっていた

## 修正内容

### 1. 用語選択ロジックの分離
- **`handleTermSelect`**: 用語リンククリック時用（ドキュメント選択を保持）
- **`handleTermSelectFromMenu`**: メニューから用語選択時用（ドキュメント選択をクリア）

### 2. 動作の使い分け
- **ドキュメント内の用語リンククリック**: コンテンツペインの状態を保持し、サブペインのみに用語ページ表示
- **メニューから用語選択**: ドキュメント選択をクリアし、サブペインに用語ページ表示

### 3. 修正ファイル
- `app/page.tsx`: 用語選択ロジックを分離し、適切なハンドラーを使用

## 修正後の動作フロー

### ドキュメント内用語リンククリック時
1. コンテンツペイン: ドキュメント内容を保持（変化なし）
2. サブペイン: 「用語」タブがアクティブになり、用語ページを表示
3. ドキュメント選択状態: 保持される

### メニューから用語選択時
1. コンテンツペイン: 空になる（ドキュメント選択がクリア）
2. サブペイン: 「用語」タブがアクティブになり、用語ページを表示
3. ドキュメント選択状態: クリアされる

## 結果
✅ 用語リンククリック時にコンテンツペインの状態が保持されるようになりました
✅ サブペインには用語ページが正しく表示されます
✅ メニューから用語選択時は適切にドキュメント選択がクリアされます
✅ 副作用が解消されました

## 現在の仕様
- **ドキュメント内用語リンク**: コンテンツペイン状態保持 + サブペインに用語ページ表示
- **メニューから用語選択**: ドキュメント選択クリア + サブペインに用語ページ表示
- **ドキュメント選択**: コンテンツペインにドキュメント表示 + サブペインにTOC表示
