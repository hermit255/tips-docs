# チャットログ - 2025年09月22日 17:15

## ユーザーリクエスト
あなたの説明と異なっています。クリック時にコンテンツペインが「ドキュメントまたは用語を選択してください」に切り替わってしまっています

## 問題の分析
**実際に発生していた問題**:
- 用語リンクをクリック → ContentPaneで`selectedTerm`のuseEffectが実行される
- `setDoc(null)`が実行されてドキュメントがクリアされる
- 「ドキュメントまたは用語を選択してください」が表示される

**原因**:
- ContentPaneの`useEffect`で`selectedTerm`が変更されると`setDoc(null)`を実行していた
- 用語選択時にドキュメント状態がクリアされてしまっていた

## 修正内容

### 1. ContentPaneのuseEffectを無効化
- `selectedTerm`のuseEffectをコメントアウト
- 用語選択時にドキュメント状態がクリアされないように修正

### 2. 修正前の動作
```javascript
useEffect(() => {
  if (selectedTerm) {
    setLoading(true)
    fetch(`/api/terms/${selectedTerm}`)
      .then(res => res.json())
      .then(data => {
        setTerm(data)
        setDoc(null) // ← これが問題
      })
      .catch(err => console.error('Failed to fetch term:', err))
      .finally(() => setLoading(false))
  }
}, [selectedTerm])
```

### 3. 修正後の動作
- 用語選択時はContentPaneでは何もしない
- ドキュメント状態が保持される
- サブペインでのみ用語ページを表示

## 修正ファイル
- `components/ContentPane.tsx`: selectedTermのuseEffectを無効化

## 修正後の動作フロー

### ドキュメント内用語リンククリック時
1. **コンテンツペイン**: ドキュメント内容を保持（変化なし）
2. **サブペイン**: 「用語」タブがアクティブになり、用語ページを表示
3. **ドキュメント状態**: 完全に保持される

### メニューから用語選択時
1. **コンテンツペイン**: 空になる（ドキュメント選択がクリア）
2. **サブペイン**: 「用語」タブがアクティブになり、用語ページを表示
3. **ドキュメント状態**: クリアされる（適切な動作）

## 結果
✅ 用語リンククリック時にコンテンツペインの状態が完全に保持されるようになりました
✅ 「ドキュメントまたは用語を選択してください」が表示されなくなりました
✅ サブペインには用語ページが正しく表示されます
✅ 副作用が完全に解消されました

## 現在の仕様
- **ドキュメント内用語リンク**: コンテンツペイン状態完全保持 + サブペインに用語ページ表示
- **メニューから用語選択**: ドキュメント選択クリア + サブペインに用語ページ表示
- **ドキュメント選択**: コンテンツペインにドキュメント表示 + サブペインにTOC表示
