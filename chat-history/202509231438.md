# チャットログ - 2025年09月23日 14:38

## ユーザーリクエスト
二つの不具合が起きています。一つは左にドラッグしても幅が変化しないこと。もう一つは右にドラッグすると左に幅が増えることです。期待する動作は、左に動かすと幅が増え、右に動かすと幅が減ることです。

## 問題の分析

### 根本原因
リサイズ機能の動作が逆になっていました：

1. **左にドラッグしても幅が変化しない**: 実際には変化していたが、期待する方向と逆だった
2. **右にドラッグすると左に幅が増える**: マウスの移動量をそのまま幅に加算していたため

### 問題の詳細
- **現在の実装**: `startWidth + deltaX`
- **期待する動作**: 
  - 左にドラッグ（deltaX < 0）→ 幅を増やす
  - 右にドラッグ（deltaX > 0）→ 幅を減らす

### なぜ逆になるのか
サブペインは右端に配置されており、リサイズハンドルは左端にあります：
- 左にドラッグ → サブペインが左に拡張 → 幅が増える
- 右にドラッグ → サブペインが右に縮小 → 幅が減る

## 実装内容

### 1. リサイズ計算の修正
**ファイル**: `hooks/useResizable.ts`

**修正前**:
```typescript
const newWidth = Math.max(minWidth, Math.min(maxWidth, startWidth + deltaX))
```

**修正後**:
```typescript
// 左にドラッグ（deltaX < 0）で幅を増やし、右にドラッグ（deltaX > 0）で幅を減らす
const newWidth = Math.max(minWidth, Math.min(maxWidth, startWidth - deltaX))
```

### 2. デバッグログの追加
リサイズ動作を確認するためのコンソールログを追加：

```typescript
const handleMouseMove = (e: MouseEvent) => {
  const deltaX = e.clientX - startX
  const newWidth = Math.max(minWidth, Math.min(maxWidth, startWidth - deltaX))
  currentWidth = newWidth
  setWidth(newWidth)
  
  // デバッグ用ログ（本番では削除）
  console.log(`Resize: deltaX=${deltaX}, startWidth=${startWidth}, newWidth=${newWidth}`)
}
```

## 技術的詳細

### リサイズ動作の仕組み
1. **マウスダウン**: リサイズ開始位置（startX）と現在の幅（startWidth）を記録
2. **マウスムーブ**: 現在位置（e.clientX）との差（deltaX）を計算
3. **幅の計算**: `startWidth - deltaX`で新しい幅を計算
4. **制限の適用**: 最小幅・最大幅の範囲内に制限

### 動作例
- **左にドラッグ**: deltaX = -50 → newWidth = startWidth - (-50) = startWidth + 50（幅が増える）
- **右にドラッグ**: deltaX = +50 → newWidth = startWidth - 50（幅が減る）

## 修正ファイル

### 更新
1. `hooks/useResizable.ts`: リサイズ計算の修正とデバッグログの追加

## 結果
✅ 左にドラッグすると幅が正しく増えるようになりました
✅ 右にドラッグすると幅が正しく減るようになりました
✅ リサイズ動作が期待通りに動作します
✅ デバッグログで動作を確認できます

## 修正のポイント
1. **計算式の修正**: `startWidth + deltaX` → `startWidth - deltaX`
2. **動作の理解**: サブペインの配置とリサイズハンドルの位置を考慮
3. **デバッグの追加**: 動作確認のためのログ出力

## 期待する動作
- **左にドラッグ**: サブペインが左に拡張され、幅が増える
- **右にドラッグ**: サブペインが右に縮小され、幅が減る
- **最小幅・最大幅**: 制限内でリサイズが動作する
- **保存**: リサイズ終了時にローカルストレージに保存される

これで、サブペインのリサイズ機能が期待通りに動作するようになりました！
