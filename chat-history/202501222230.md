# 特殊リンク仕様の追加実装

## 実装内容

### 追加された仕様
- リンクできるmdが複数ある場合、長いほうを優先する
- "terms"と"terms_01"がある場合は後者としてリンクする

### 実装変更

#### 1. processContentWithLinks関数の修正

`lib/markdown-client.ts`の`processContentWithLinks`関数を修正：

```typescript
// 用語ファイル名を長さ順でソート（長い順）
const sortedTerms = [...terms].sort((a, b) => b.title.length - a.title.length)

// ドキュメントファイル名を長さ順でソート（長い順）
const sortedDocs = [...docs].sort((a, b) => b.title.length - a.title.length)
```

#### 2. 処理順序の変更

- 用語とドキュメントの処理順序を長い名前から短い名前の順に変更
- これにより、長い名前が先に処理され、短い名前との競合を回避

### テスト用ファイルの作成

#### 用語ファイル
1. `projects/default/terms/terms.md` - 短い名前の用語
2. `projects/default/terms/terms_01.md` - 長い名前の用語

#### ドキュメントファイル
1. `projects/default/docs/sampleDoc_01.md` - 長い名前のドキュメント
2. `projects/default/docs/linkTest.md` - 特殊リンクのテスト用ドキュメント

### テスト内容

`linkTest.md`で以下の動作をテスト：

1. **用語リンクのテスト**
   - "terms" → 短い名前の用語にリンク
   - "terms_01" → 長い名前の用語にリンク（優先される）

2. **ドキュメントリンクのテスト**
   - "sampleDoc" → 短い名前のドキュメントにリンク
   - "sampleDoc_01" → 長い名前のドキュメントにリンク（優先される）

3. **除外テスト**
   - "##terms##" → リンク化されない
   - "##terms_01##" → リンク化されない

### 技術的な実装詳細

#### ソート処理
```typescript
const sortedTerms = [...terms].sort((a, b) => b.title.length - a.title.length)
```

- スプレッド演算子で配列をコピー
- `sort`メソッドで長さ順にソート（降順）
- 長い名前が先に処理されるため、短い名前との競合を回避

#### 処理順序の重要性
- 正規表現の`replace`メソッドは最初にマッチした部分を置換
- 長い名前を先に処理することで、短い名前が長い名前の一部を置換することを防止

### 動作確認

- Docker Composeでサービスを再起動
- リンターエラーなし
- テスト用ファイルを作成して動作確認可能

## 実装結果

- 複数のマッチがある場合に長い名前が優先される仕様を実装
- 用語とドキュメントの両方で長い名前優先の処理を実装
- テスト用ファイルを作成して動作確認が可能
