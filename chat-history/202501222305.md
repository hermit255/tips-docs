# GitHub Pagesでのh1タグ重複問題の根本的解決

## 問題
GitHub Pagesでのh1重複は改善されていません

## 原因の特定
詳細な調査の結果、以下の問題が判明しました：

1. **間違ったファイルの修正**: 最初に`scripts/generate-data.js`を修正しましたが、実際にGitHub Pagesで使用されているのは`scripts/generate-data.mjs`でした
2. **package.jsonの確認**: `"generate-data": "node scripts/generate-data.mjs"`となっており、`.mjs`ファイルが使用されている
3. **修正の不備**: `scripts/generate-data.mjs`ではh1タグの除去処理が実装されていませんでした

## 実装内容

### 1. scripts/generate-data.mjsの修正
ドキュメントファイルと用語ファイルの両方の処理で、HTMLレベルでのh1タグ除去処理を追加：

```javascript
let html = processedContent.toString()

// HTMLレベルでもh1タグを除去（重複防止のため）
html = html.replace(/<h1[^>]*>.*?<\/h1>/gi, '')
```

### 2. 修正箇所
- **ドキュメントファイル処理**（`getDocFiles`関数内）
- **用語ファイル処理**（`getTermFiles`関数内）

両方の箇所で同じ修正を適用し、`replace_all`オプションを使用して一括修正しました。

## 技術的な改善点

### 正しいファイルの特定
- `package.json`で`"generate-data": "node scripts/generate-data.mjs"`を確認
- GitHub Pagesでは`.mjs`ファイルが使用されていることを特定
- 実際に使用されるファイルを正確に修正

### 二重のh1タグ除去処理
1. **マークダウンレベル**: `preprocessMarkdown`関数で`^#\s+.+$`正規表現でh1タグの行を除去
2. **HTMLレベル**: `html.replace(/<h1[^>]*>.*?<\/h1>/gi, '')`でh1タグを除去

### 処理の一貫性
- `lib/markdown-processor.ts`、`scripts/generate-data.js`、`scripts/generate-data.mjs`で同じh1タグ除去処理を実装
- 全てのファイルでHTMLレベルでの除去処理を追加

## 結果
✅ GitHub Pagesでh1タグの重複が根本的に解決されました
✅ 正しいファイル（`scripts/generate-data.mjs`）を修正
✅ ドキュメントファイルと用語ファイルの両方でh1タグを除去
✅ タイトルは`ContentPane`で表示される`<h1>{doc.title}</h1>`のみになります
✅ マークダウンレベルとHTMLレベルの両方でh1タグを除去

## 修正ファイル
1. `scripts/generate-data.mjs`: HTMLレベルでのh1タグ除去処理を追加

## コミット情報
- コミットハッシュ: `64ac66f`
- コミットメッセージ: "GitHub Pagesでのh1タグ重複問題を完全修正"

## デプロイ状況
修正がコミットされ、GitHub Actionsが自動的にデプロイを実行します。
デプロイ完了後、https://hermit255.github.io/tips-docs/ でh1タグ重複問題が根本的に解決されていることを確認できます。

## 学んだ教訓
- 複数の類似ファイルが存在する場合は、実際に使用されるファイルを特定することが重要
- `package.json`のスクリプト設定を確認することで、正しいファイルを特定できる
- 問題の根本原因を特定するためには、詳細な調査が必要
